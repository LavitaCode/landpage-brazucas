<div class="card shadow-sm border-0 cbt-root" role="dialog" aria-label="Chatbot">
    <!-- Header -->
    <div class="card-header d-flex align-items-center justify-content-between">
        <div class="d-flex align-items-center gap-2">
            <i class="bi bi-robot fs-5 text-accent" aria-hidden="true"></i>
            <div class="lh-1">
                <strong class="title">Atendimento Assistido</strong>
            </div>
        </div>

        <!-- Botão compacto (icon-first). Em telas pequenas, o texto some -->
        <button
                type="button"
                class="btn btn-outline-light btn-reset d-inline-flex align-items-center"
                (click)="reset()"
                aria-label="Reiniciar conversa"
                title="Reiniciar"
        >
            <i class="bi bi-arrow-clockwise" aria-hidden="true"></i>
            <span class="btn-text">Reiniciar</span>
        </button>
    </div>

    <!-- Body -->
    <div class="card-body">
        <div class="cbt-body" aria-live="polite">
            <ng-container *ngFor="let m of messages(); trackBy: trackByMsgId">
                <!-- BOT -->
                <div *ngIf="m.author === 'bot'; else userTpl" class="d-flex align-items-start mb-3">
                    <i class="bi bi-robot text-accent me-2 mt-1" aria-hidden="true"></i>
                    <div class="flex-grow-1">
                        <div class="bubble bubble-bot small">{{ m.text }}</div>
                        <div class="small time">
                            <i class="bi bi-clock" aria-hidden="true"></i> {{ m.at | date:'HH:mm' }}
                        </div>
                    </div>
                </div>

                <!-- USUÁRIO -->
                <ng-template #userTpl>
                    <div class="d-flex align-items-start justify-content-end mb-3">
                        <div class="text-end">
                            <div class="bubble bubble-user small">{{ m.text }}</div>
                            <div class="small time">
                                <i class="bi bi-clock" aria-hidden="true"></i> {{ m.at | date:'HH:mm' }}
                            </div>
                        </div>
                        <i class="bi bi-person-circle text-accent-weak ms-2 mt-1" aria-hidden="true"></i>
                    </div>
                </ng-template>
            </ng-container>
        </div>
    </div>

    <!-- Footer (sempre visível, 2 colunas, múltiplas linhas) -->
    <div class="card-footer">
        <div class="cbt-options-grid">
            <button
                    type="button"
                    class="btn cbt-option btn-outline-light btn-sm"
                    *ngFor="let op of options(); trackBy: trackByOptionId"
                    (click)="choose(op)"
            >
                <i class="bi bi-chat-right-text me-2" aria-hidden="true"></i>
                <!-- Agora com quebra de linha: sem text-truncate -->
                <span class="option-label">{{ op.label }}</span>
            </button>
        </div>
    </div>
</div>
